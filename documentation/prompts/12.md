Let's implement the payment system integration using Stripe to allow users to purchase calling credits.

1. Set up Stripe integration:
   - Add stripe gem
   - Configure API keys
   - Create webhook endpoint

2. Create the credits controller:
   ```ruby
   rails generate controller Api::Credits create show
   ```

3. Implement the credit packages model:
   ```ruby
   rails generate model CreditPackage name:string amount_cents:integer price_cents:integer
   ```

4. Build the Stripe checkout service:
   ```ruby
   # app/services/stripe_checkout_service.rb
   class StripeCheckoutService
     def initialize(user, credit_package)
       @user = user
       @credit_package = credit_package
     end

     def create_session
       # Create Stripe Checkout session
     end

     def process_successful_payment(session_id)
       # Handle successful payment
     end
   end
   ```

5. Implement Stripe webhook controller:
   ```ruby
   rails generate controller Api::StripeWebhooks create
   ```

6. Create the credit transaction service:
   ```ruby
   # app/services/credit_transaction_service.rb
   class CreditTransactionService
     def self.add_credits(user, amount, source, metadata = {})
       # Add credits to user account
       # Create transaction record
     end

     def self.deduct_credits(user, amount, call = nil)
       # Deduct credits for call
       # Create transaction record
     end
   end
   ```

7. Add credit balance checks:
   - Implement User#sufficient_balance? method
   - Create low balance detection
   - Add automatic credit purchase reminders

8. Build transaction history functionality:
   - List all user transactions
   - Filter by type (purchase, usage)
   - Show balance changes over time

9. Implement RSpec tests for payment flow:
   - Test checkout session creation
   - Test webhook processing
   - Test credit balance updates

The payment system should handle the complete flow from selecting a credit package to completing payment and updating the user's credit balance. Ensure proper error handling for failed payments and clear transaction records for all operations.